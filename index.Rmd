---
title: "Encuesta de Egresados"
runtime: shiny
output: html_document
---

```{r setup, include=FALSE}
library(shiny)
library(DT)
library(ggplot2)
```

```{r, echo=FALSE}
ui <- fluidPage(
  titlePanel("Datos Personales"),
  textInput("nombre", "Nombres Completos*"),
  textInput("apellido", "Apellidos Completos*"),
  textInput("cedula", "Número de Cédula*"),
  textInput("celular", "Teléfono/Celular*"),
  textInput("email", "Correo Electrónico*"),
  selectInput("promocion", "Promoción*", choices = 2023:2024),
  selectInput("carrera", "Carrera*",
              choices = c("Mecánica Automotriz", "Mecatrónica", "Contabilidad")),
  actionButton("guardar_datos", "Guardar Datos", class = "btn-primary")
)

server <- function(input, output, session) {
  # Aquí puedes agregar lógica si necesitas procesar datos
}

shinyApp(ui, server)
```


### Encuesta

```{r, echo=FALSE}
radioButtons("p1", "¿Actualmente usted se encuentra trabajando?", choices = c("Sí", "No"), inline = TRUE)

conditionalPanel(
  condition = "input.p1 == 'Sí'",
  textInput("p1a_cargo", "¿Cuál es su cargo actual?"),
  textInput("p1a_empresa", "Nombre de la empresa o institución"),
  selectInput("p1a_sector", "Sector económico", choices = c("Público", "Privado", "ONG", "Otro")),
  numericInput("p1a_sueldo", "Ingreso mensual (USD)", value = 0, min = 0),
  radioButtons("p1a_relacion", "¿Relacionado con su formación?", choices = c("Sí", "No"), inline = TRUE)
)


conditionalPanel(
  condition = "input.p1 == 'No'",
  radioButtons("p1b_razon", "Razón por la que no trabaja",
               choices = c("Estoy estudiando", "No encuentro trabajo", 
                          "No estoy interesado en trabajar", "Otro"))
)

radioButtons("p2", "¿Cómo califica la formación técnica?",
             choices = c("Excelente", "Buena", "Regular", "Mala"), inline = TRUE)

checkboxGroupInput("p2b", "¿Qué aspectos mejoraría?",
                   choices = c("Plan de estudios", "Talleres prácticos", 
                               "Profesores", "Equipamiento técnico", 
                               "Vinculación con empresas"))

textAreaInput("p2c", "Comentarios adicionales")

sliderInput("p3a", "Habilidades prácticas", min = 1, max = 5, value = 3)
sliderInput("p3b", "Conocimientos técnicos", min = 1, max = 5, value = 3)
sliderInput("p3c", "Manejo de equipos", min = 1, max = 5, value = 3)
sliderInput("p3d", "Resolución de problemas", min = 1, max = 5, value = 3)

actionButton("enviar_encuesta", "Enviar Encuesta", class = "btn-success")
```

-----------------------------------------------------------------------

### Resultados

```{r, echo=FALSE}
datos <- reactiveValues(
  personales = NULL,
  respuestas = list()
)

observeEvent(input$guardar_datos, {
  datos$personales <- data.frame(
    Nombre = input$nombre,
    Apellido = input$apellido,
    Cedula = input$cedula,
    Celular = input$celular,
    Email = input$email,
    Promocion = input$promocion,
    Carrera = input$carrera,
    Fecha = Sys.Date()
  )
  showNotification("Datos personales guardados!", type = "message")
})

observeEvent(input$enviar_encuesta, {
  datos$respuestas <- list(
    situacion_laboral = list(
      trabaja = input$p1,
      cargo = if(input$p1 == "Sí") input$p1a_cargo else NA,
      empresa = if(input$p1 == "Sí") input$p1a_empresa else NA,
      sector = if(input$p1 == "Sí") input$p1a_sector else NA,
      sueldo = if(input$p1 == "Sí") input$p1a_sueldo else NA,
      relacion = if(input$p1 == "Sí") input$p1a_relacion else NA,
      razon_no_trabaja = if(input$p1 == "No") input$p1b_razon else NA
    ),
    satisfaccion = list(
      calificacion = input$p2,
      aspectos_mejorar = input$p2b,
      comentarios = input$p2c
    ),
    competencias = list(
      habilidades_practicas = input$p3a,
      conocimientos_tecnicos = input$p3b,
      manejo_equipos = input$p3c,
      resolucion_problemas = input$p3d
    )
  )
  showNotification("Encuesta enviada correctamente!", type = "message")
})

renderPlot({
  req(datos$respuestas$situacion_laboral$trabaja)
  df <- data.frame(
    Categoria = c("Trabajando", "No Trabajando"),
    Valor = c(sum(datos$respuestas$situacion_laboral$trabaja == "Sí"), 
              sum(datos$respuestas$situacion_laboral$trabaja == "No"))
  )
  ggplot(df, aes(x = Categoria, y = Valor, fill = Categoria)) +
    geom_bar(stat = "identity") +
    labs(title = "Situación Laboral de Egresados", y = "Cantidad") +
    scale_fill_manual(values = c("#0056b3", "#6c757d")) +
    theme_minimal()
})

renderDT({
  req(datos$personales)
  df <- data.frame(
    Nombre = paste(datos$personales$Nombre, datos$personales$Apellido),
    Carrera = datos$personales$Carrera,
    Promocion = datos$personales$Promocion,
    Trabaja = datos$respuestas$situacion_laboral$trabaja,
    Satisfaccion = datos$respuestas$satisfaccion$calificacion
  )
  datatable(df, options = list(pageLength = 5))
})
```
